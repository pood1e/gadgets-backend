---
title: README
date: 2025-06-26 14:56:10
tags: [ ]
---

# gadgets-server

## 架构设计

- 为了满足不同需求，支持两种打包部署方式
    - 按需多合一: 降低资源要求和部署难度，可以选择需要的模块
        - 基础设施/业务应用分离:
            - 按需基础设施多合一: 需要保证开发行为标准化, 支持无缝切换云
            - 按需业务应用多合一: 对基础设施实现无感知
        - 基础设施/业务应用合一:
            - 按需基础设施加业务应用多合一: 自带基础设施
    - 微服务: 单体应用高可用
- 为了便于开发，划分为多个模块，每个模块有自己的职责
    - 基础设施:
        - Api网关: 流量统一入口/限流/请求路由
        - Auth鉴权: 登陆/注册/用户信息提供/OAuth+OpenID
        - 服务发现: 服务发现
        - 配置服务器: 统一配置管理
        - 分布式追踪：监控
        - ...
    - 业务应用:
        - 剪贴板: 多设备共享
        - ...

## 基础设施

### 认证服务

- 单用户：自研
- 少量用户：自研
- 多用户：Keycloak

提供api：登陆

#### 用户信息

- 单用户
    - 单一预置用户，无需额外数据库
- 少量用户
    - 有注册功能
    - 使用简单的数据库引擎如sqlite
- 多用户
    - 关系型数据库mysql
    - Keycloak

#### 客户端令牌

- 单用户
    - 文件持久化+内存存储令牌
    - 令牌内不需要包含信息
- 少量用户
    - 文件数据库sqlite+内存存储令牌
- 多用户
    - jwt
    - 透明令牌+redis

#### 角色管理

- 系统预置
    - 系统
    - 管理员
    - 用户（非单用户）
- 业务自定义

#### 权限管理

- 系统预置
    - 系统
    - 管理员
    - 用户（非单用户）
- 业务自定义

#### 角色表

#### 权限表

- 配额修改 

### 路由决策

- 单用户: [spring security 硬编码的规则](https://www.baeldung.com/spring-security-authorization-opa)
- 少量用户: [spring security 硬编码的规则](https://www.baeldung.com/spring-security-authorization-opa)
- 多用户: [opa](https://medium.com/@lalosaimi/open-policy-agent-opa-in-spring-boot-2d96d70cb947) 